<head>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
  <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet">
  <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
  <script src="/_expose.js"></script>
  <style type="text/css">
    body {
      position: relative;
    }
    #container {
      position: absolute;
      bottom: 0px;
      width: 100%;
      max-height: 100%;
    }
    #input #msg {
      float: left;
      width: 85%;
    }
    #input #send {
      float: right;
      width: 15%;
    }
  </style>
</head>
<body>
  <div id="container">
    <div id="messages"></div>
    <div id="input">
      <input id="msg" type="text" placeholder="Message"></input>
      <button id="send">Send</button>
    </div>
  </div>
  <script type="text/javascript">
    var expose = ExposeClient();
    function send(msg) {
      var data = $("#msg").val();
      if (data.length===0) return;
      $("#msg").val(function(){return ""});
      expose.withServerApi(function(api){
        api.sendMessage(data);
      });
    }
    expose.expose("putMessage", function(msg){
      $("#messages").append('<div>' + msg + '</div>');
      $("#input").get(0).scrollIntoView();
    });
    expose.start("localhost", 8080);
    $("#send").click(function(){
      send();
    });
    $("#input").keyup(function (e) {
      if (e.keyCode == 13) {
        send();
      }
    });
    expose.withServerApi(function(api){
      var name = localStorage.getItem("name") || prompt("Who are you?");
      if (name) localStorage.setItem("name", name);
      api.register(name || "Anonymous");
      $("#msg").focus();
    });
  </script>
</body>
